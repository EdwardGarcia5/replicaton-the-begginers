```{r}
#Your code goes here
library(ggplot2)
library(knitr)
library(dplyr)
library(reshape2)
library(energy)

data <- read.csv("rawPharmacoData.csv")
datasum <- read.csv("summarizedPharmacoData.csv")

str(data)

dataCCLE <- data[data$study == "CCLE",]
dataGDSC <- data[data$study == "GDSC",]
unique(dataCCLE$concentration)

length( levels( data$cellLine ) )

tapply( data$concentration, data$study, function(x){
        length( unique( x ) )
    })

ggplot( pharmacoData, aes( log2(viability) ) ) +
    geom_histogram(fill = "white", colour="black") +
    facet_wrap(~study)

sum( data$viability > 0 & data$viability < 100)

str(datasum)

ggplot( pharmacoData, aes( viability, group=drug, colour=drug) ) +
    geom_density(fill="white", lwd=2, alpha=0.1) + xlim(0, 170)

ggplot(aes(x=auc_GDSC, y=auc_CCLE), data=cellLinesSummary) +
    geom_point(cex=0.5) +
    facet_wrap(facets=~drug) +
    xlab("GDSC AUC") +
    ylab("CCLE AUC")

cor.coef <- round(cor(datasum$auc_GDSC, datasum$auc_CCLE),2)
ggplot(aes(x=auc_GDSC, y=auc_CCLE), data=cellLinesSummary) +
    geom_point(cex=0.5) +
    facet_wrap(facets=~drug) +
    ggtitle(paste0("Correlation coefficient = ", cor.coef))+ 
    xlab("GDSC AUC") +
    ylab("CCLE AUC") +
    geom_smooth(method='lm', se=FALSE)

ggplot(aes(x=ic50_GDSC, y=ic50_CCLE), data=cellLinesSummary) +
    geom_point(cex=0.5) +
    facet_wrap(facets=~drug) +
    xlab("GDSC ic50") +
    ylab("CCLE ic50")

cor.coef <- round(cor(datasum$ic50_GDSC, datasum$ic50_CCLE),2)
ggplot(aes(x=ic50_GDSC, y=ic50_CCLE), data=cellLinesSummary) +
    geom_point(cex=0.5) +
    facet_wrap(facets=~drug) +
    ggtitle(paste0("Correlation coefficient = ", cor.coef))+ 
    xlab("GDSC ic50") +
    ylab("CCLE ic50") +
    geom_smooth(method='lm', se=FALSE)


drugCorrs <- cellLinesSummary %>% 
    group_by(drug) %>% summarise(Pearson_ic50=cor(-log10(ic50_GDSC/10^6),-log10(ic50_CCLE/10^6), method="pearson"),
                                 Spearman_ic50=cor(-log10(ic50_GDSC/10^6),-log10(ic50_CCLE/10^6), method="spearman"))
drugCorrs <- melt(drugCorrs)
colnames(drugCorrs) <- c("Drug", "Measure", "Correlation")

drugCorrs_IC50 <- drugCorrs[grep("ic50", drugCorrs$Measure),]
ggplot(data=drugCorrs_IC50, aes(x=Drug, y=Correlation, fill=Measure, group=Measure)) +
  geom_bar(stat="identity", position=position_dodge(), colour="black") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_grey()

drugCorrss <- cellLinesSummary %>% 
    group_by(drug) %>% summarise(Pearson_auc=cor(-log10(auc_GDSC/10^6),-log10(auc_CCLE/10^6), method="pearson"),
                                 Spearman_auc=cor(-log10(auc_GDSC/10^6),-log10(auc_CCLE/10^6), method="spearman"))
drugCorrss <- melt(drugCorrss)
colnames(drugCorrss) <- c("Drug", "Measure", "Correlation")

drugCorrs_auc <- drugCorrss[grep("ic50", drugCorrss$Measure),]
ggplot(data=drugCorrs_auc, aes(x=Drug, y=Correlation, fill=Measure, group=Measure)) +
  geom_bar(stat="identity", position=position_dodge(), colour="black") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_grey()

dcor.t(datasum$ic50_GDSC,datasum$ic50_CCLE)
dcor.ttest(datasum$ic50_GDSC,datasum$ic50_CCLE)
```
